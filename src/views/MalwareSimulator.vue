<template>
  <div class="animated fadeIn">
    <div class="button-panel">
      <router-link to="/malware/add" class="btn btn-info btn-sm"><i class="fa fa-plus"></i> Add Malware Campaign</router-link>
    </div>


    <div class="card" v-for="campaign in campaigns">
      <div class="card-header">
        {{campaign.CampaignName}} <code></code>
        <div class="card-actions">
          <router-link :to="{path: '/malware/edit/'+campaign.Id}" class="btn-minimize collapsed"><i class="fa fa-pencil"></i></router-link>
          <a class="btn-minimize collapsed" v-on:click="deleteCampaign(campaign)"><i class="fa fa-trash"></i></a>
        </div>
      </div>
      <div class="card-block">
        <p>
          {{campaign.CampaignDescription}}
        </p>

        <table class="table table-striped table-responsive">
          <thead>
          <tr>
            <th>Computer Name</th>
            <th>User Name</th>
            <th>Internal IP</th>
            <th>External IP</th>
            <th>OS Version</th>
          </tr>
          </thead>
          <tbody>
          <tr v-for="result in campaign.resultData">
            <td>{{result.ComputerName}}</td>
            <td>{{result.UserName}}</td>
            <td>{{result.InternalIp}}</td>
            <td>{{result.ExternalIp}}</td>
            <td>{{result.OsVersion}}</td>
          </tr>

          </tbody>
        </table>

      </div>
      <div class="card-footer">
        phsr-id: <code>{{phsrId}}</code> phsr-campaign-id: <code>{{campaign.CampaignRandomId}}</code>
      </div>
    </div>
  </div>
</template>
<script>
  import config from '../config'
  export default {
    name: 'malware-simulator',
    data: function () {
      return {
        campaigns: [],
        phsrId: ''
      }
    },
    created: function () {
      this.refreshData()
      this.phsrId = config.phsrId
    },
    methods: {
      refreshData () {
        this.$http.post(
          config.apiServer + '/mware/get-user-campaigns',
          {
            token: this.$store.token

          }).then(
          function success (response) {
            this.campaigns = JSON.parse(response.bodyText).campaigns
          },
          function fail (response) {
            var result = JSON.parse(response.bodyText)
            // TODO: Local String, not out of response.
            this.errorText = result.message
            this.submitted = false
          }
        )
      },
      deleteCampaign (campaign) {
        this.$http.post(
          config.apiServer + '/mware/delete-campaign',
          {
            token: this.$store.token,
            campaignId: campaign.Id

          }).then(
          function success (response) {
            this.refreshData()
          },
          function fail (response) {
            var result = JSON.parse(response.bodyText)
            // TODO: Local String, not out of response.
            this.errorText = result.message
            this.submitted = false
          }
        )
      }
    }
  }
</script>
